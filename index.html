function openReaderFullScreen(story) {
  const readerFull = document.getElementById('readerFull');
  readerFull.innerHTML = '';

  const panel = document.createElement('div');
  panel.className = 'reader-full';
  panel.style.position = 'fixed';
  panel.style.top = 0;
  panel.style.left = 0;
  panel.style.width = '100vw';
  panel.style.height = '100vh';
  panel.style.background = '#f7f7fb';
  panel.style.zIndex = 1200;
  panel.style.display = 'flex';
  panel.style.flexDirection = 'column';

  // --- HEADER ---
  const header = document.createElement('div');
  header.className = 'reader-header';
  header.style.display = 'flex';
  header.style.justifyContent = 'space-between';
  header.style.alignItems = 'center';
  header.style.padding = '12px 18px';
  header.style.background = '#fff';

  const profileRaw = localStorage.getItem(STORAGE_KEY);
  let author = '‚Äî';
  if (profileRaw) {
    try { author = JSON.parse(profileRaw).name || '‚Äî'; } catch (e) {}
  }
  const dateStr = story.publishedOn || new Date().toISOString().split('T')[0];

  header.innerHTML = `
    <div>
      <strong>${story.title}</strong>
      <div class="muted" style="font-size:12px">${story.genre || '‚Äî'} ‚Ä¢ Written by ${author} ‚Ä¢ ${dateStr}</div>
    </div>
    <div>
      <button id="readerCloseFullBtn" class="btn btn-secondary">Close</button>
    </div>
  `;
  panel.appendChild(header);

  // --- BODY ---
  const body = document.createElement('div');
  body.className = 'reader-body';
  body.style.flex = 1;
  body.style.overflowY = 'auto';
  body.style.display = 'flex';
  body.style.flexDirection = 'column';
  body.style.alignItems = 'center';
  body.style.justifyContent = 'flex-start';
  body.style.padding = '12px';

  const sheet = document.createElement('div');
  sheet.className = 'reader-sheet';
  sheet.style.position = 'relative';
  sheet.style.width = '100%';
  sheet.style.maxWidth = '880px';
  sheet.style.minHeight = '400px';
  sheet.style.padding = '20px';
  sheet.style.background = '#fffef9';
  sheet.style.border = '1px solid #e5d7b7';
  sheet.style.borderRadius = '12px';
  sheet.style.boxShadow = '0 8px 16px rgba(0,0,0,0.1)';
  sheet.style.fontFamily = `'Georgia', 'Times New Roman', serif`;
  sheet.style.fontSize = '16px';
  sheet.style.lineHeight = '1.6';
  sheet.style.color = '#2e2b23';
  sheet.style.textAlign = 'justify';
  sheet.style.letterSpacing = '0.3px';
  sheet.style.whiteSpace = 'pre-wrap';
  sheet.style.overflowWrap = 'break-word';
  body.appendChild(sheet);

  // --- CANVAS ---
  const canvas = document.createElement('canvas');
  canvas.style.position = 'absolute';
  canvas.style.top = 0;
  canvas.style.left = 0;
  canvas.style.width = '100%';
  canvas.style.height = '100%';
  canvas.style.pointerEvents = 'none';
  sheet.appendChild(canvas);

  // --- CONTROLS ---
  const controls = document.createElement('div');
  controls.className = 'reader-controls';
  controls.style.display = 'flex';
  controls.style.flexWrap = 'wrap';
  controls.style.gap = '6px';
  controls.style.marginTop = '12px';
  controls.innerHTML = `
    <button id="prevFullBtn" class="btn btn-secondary">‚óÄ Prev</button>
    <button id="startFullBtn" class="btn btn-primary">Start</button>
    <button id="nextFullBtn" class="btn btn-secondary">Next ‚ñ∂</button>
    <button id="markBtn" class="btn btn-warning">‚úèÔ∏è Mark Last Read</button>
    <button id="removeMarkBtn" class="btn btn-danger" style="display:none;">üóëÔ∏è Remove Last Mark</button>
  `;
  body.appendChild(controls);
  panel.appendChild(body);
  readerFull.appendChild(panel);
  readerFull.classList.remove('hidden');

  const sheets = story.sheets || [{ content: '' }];
  let idx = 0;
  const savedKey = `lastReadMark_${story.id || story.title}`;

  // --- CANVAS CONTEXT ---
  const ctx = canvas.getContext('2d');
  ctx.strokeStyle = 'red';
  ctx.lineWidth = 2;
  let drawing = false;
  let lastX = 0, lastY = 0;

  function enableDrawing(canvas, context) {
    // Desktop
    canvas.addEventListener('mousedown', e => {
      drawing = true;
      const rect = canvas.getBoundingClientRect();
      lastX = e.clientX - rect.left;
      lastY = e.clientY - rect.top;
    });
    canvas.addEventListener('mousemove', e => {
      if (!drawing) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      context.beginPath();
      context.moveTo(lastX, lastY);
      context.lineTo(x, y);
      context.stroke();
      lastX = x;
      lastY = y;
    });
    canvas.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('mouseout', () => drawing = false);

    // Mobile / Touch
    canvas.addEventListener('touchstart', e => {
      e.preventDefault();
      drawing = true;
      const rect = canvas.getBoundingClientRect();
      lastX = e.touches[0].clientX - rect.left;
      lastY = e.touches[0].clientY - rect.top;
    }, { passive: false });

    canvas.addEventListener('touchmove', e => {
      e.preventDefault();
      if (!drawing) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.touches[0].clientX - rect.left;
      const y = e.touches[0].clientY - rect.top;
      context.beginPath();
      context.moveTo(lastX, lastY);
      context.lineTo(x, y);
      context.stroke();
      lastX = x;
      lastY = y;
    }, { passive: false });

    canvas.addEventListener('touchend', () => drawing = false);
    canvas.addEventListener('touchcancel', () => drawing = false);
  }

  // --- LOAD MARK ---
  function loadMark() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const imgData = localStorage.getItem(`${savedKey}_${idx}`);
    if (imgData) {
      const img = new Image();
      img.onload = () => ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      img.src = imgData;
      removeMarkBtn.style.display = 'inline-block';
    } else {
      removeMarkBtn.style.display = 'none';
    }
  }

  const markBtn = document.getElementById('markBtn');
  const removeMarkBtn = document.getElementById('removeMarkBtn');
  const startBtn = document.getElementById('startFullBtn');

  // --- INITIAL LOAD ---
  sheet.textContent = sheets[idx].content || '';
  loadMark();

  // --- EVENT LISTENERS ---
  markBtn.addEventListener('click', () => {
    canvas.style.pointerEvents = 'auto';
    enableDrawing(canvas, ctx);
  });

  removeMarkBtn.addEventListener('click', () => {
    canvas.style.pointerEvents = 'none';
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    localStorage.removeItem(`${savedKey}_${idx}`);
    removeMarkBtn.style.display = 'none';
  });

  startBtn.addEventListener('click', () => {
    if (canvas) {
      localStorage.setItem(`${savedKey}_${idx}`, canvas.toDataURL());
      canvas.style.pointerEvents = 'none';
      removeMarkBtn.style.display = 'inline-block';
    }
  });

  document.getElementById('prevFullBtn').addEventListener('click', () => {
    if (idx > 0) {
      idx--;
      sheet.textContent = sheets[idx].content || '';
      loadMark();
    }
  });

  document.getElementById('nextFullBtn').addEventListener('click', () => {
    if (idx < sheets.length - 1) {
      idx++;
      sheet.textContent = sheets[idx].content || '';
      loadMark();
    }
  });

  document.getElementById('readerCloseFullBtn').addEventListener('click', () => {
    readerFull.classList.add('hidden');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  });
}
