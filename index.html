const zenShieldBtn = document.createElement('button');
zenShieldBtn.className = 'btn btn-info';
zenShieldBtn.textContent = 'ðŸ§˜ Zen Shield';
zenShieldBtn.style.marginLeft = '8px';

// Helper style for consistency
[prevBtn, nextBtn, zenShieldBtn].forEach(styleButton);

footer.append(prevBtn, nextBtn, zenShieldBtn);
panel.append(header, body, footer);

  // --- Button Actions ---
  document.getElementById('backToSerialBtn').addEventListener('click', () => {
    panel.remove();
    if (typeof openSerialPreview === 'function') openSerialPreview(serial);
  });

  prevBtn.addEventListener('click', () => {
    if (episodeIndex > 0) openSerialReader(serial.title, episodeIndex - 1);
  });

  nextBtn.addEventListener('click', () => {
    if (episodeIndex < (serial.episodes || []).length - 1)
      openSerialReader(serial.title, episodeIndex + 1);
  });

zenShieldBtn.addEventListener('click', () => {
  // Find the reader panel container
  const readerPanel = panel; // your current reading container
  const scrollContainer = readerPanel.querySelector('.reader-body') || readerPanel;

  // Remember current scroll position (inside reader only)
  const scrollY = scrollContainer.scrollTop;

  // Create shield layer *inside the reader panel only*
  const zenLayer = document.createElement('div');
  zenLayer.id = 'zenShieldLayer';
  zenLayer.style.cssText = `
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at top left, #d7e8ff 0%, #f3f9ff 30%, #eaf5f0 80%);
    backdrop-filter: blur(10px) brightness(0.95);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    overflow-y: auto;
    scroll-behavior: smooth;
    padding: 60px 0;
    z-index: 99;
    border-radius: inherit;
  `;

  // Copy reading content only
  const zenContent = document.createElement('div');
  zenContent.innerHTML = pageBox.innerHTML;
  zenContent.style.cssText = `
    max-width: 900px;
    padding: 40px 50px;
    font-size: 20px;
    line-height: 1.9;
    color: #1c1b16;
    background: rgba(255,255,255,0.9);
    border-radius: 18px;
    box-shadow: 0 12px 32px rgba(0,0,0,0.15);
    font-family: 'Georgia', 'Times New Roman', serif;
    text-align: justify;
    letter-spacing: 0.3px;
  `;

  // Close button
  const closeZenBtn = document.createElement('button');
  closeZenBtn.textContent = 'âœ– Close Shield';
  closeZenBtn.className = 'btn btn-danger';
  closeZenBtn.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    font-size: 16px;
    padding: 8px 14px;
    border-radius: 8px;
    background: #d64545;
    color: white;
    border: none;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    cursor: pointer;
  `;

  // Ambient animation (isolated)
  const ambient = document.createElement('div');
  ambient.style.cssText = `
    position:absolute;
    inset:0;
    background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), transparent 60%),
               radial-gradient(circle at 70% 70%, rgba(255,255,255,0.2), transparent 60%);
    animation: zenAmbient 8s ease-in-out infinite alternate;
    z-index:0;
  `;
  if (!document.getElementById('zenAmbientStyle')) {
    const styleTag = document.createElement('style');
    styleTag.id = 'zenAmbientStyle';
    styleTag.textContent = `
      @keyframes zenAmbient {
        0% { transform: scale(1); opacity: 0.8; }
        100% { transform: scale(1.2); opacity: 1; }
      }
    `;
    document.head.appendChild(styleTag);
  }

  zenLayer.append(ambient, zenContent, closeZenBtn);
  readerPanel.appendChild(zenLayer);

  // Hide local reader UI only
  readerPanel.querySelectorAll('.reader-header, .reader-footer')
    .forEach(el => (el.style.display = 'none'));

  // Restore scroll & UI on close
  closeZenBtn.addEventListener('click', () => {
    zenLayer.remove();
    readerPanel.querySelectorAll('.reader-header, .reader-footer')
      .forEach(el => (el.style.display = ''));
    scrollContainer.scrollTo(0, scrollY);
  });
});
